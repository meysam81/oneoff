---
import Container from '../ui/Container.astro';
import Button from '../ui/Button.astro';
import Icon from '../icons/index.astro';

const navigation = [
  { name: 'Features', href: '/#features' },
  { name: 'How it Works', href: '/#how-it-works' },
  { name: 'Comparison', href: '/#comparison' },
  { name: 'Catalog', href: '/catalog' },
];
---

<header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300" id="site-header">
  <div class="absolute inset-0 bg-bg-primary/80 backdrop-blur-md border-b border-transparent transition-all duration-300" id="header-bg"></div>

  <Container size="xl" class="relative">
    <nav class="flex items-center justify-between h-14 sm:h-16">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 text-fg-primary hover:text-accent-primary transition-colors">
        <Icon name="clock" size={24} class="text-accent-primary" />
        <span class="font-display font-semibold text-base sm:text-lg">OneOff</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-6 lg:gap-8">
        {navigation.map(item => (
          <a
            href={item.href}
            class="text-fg-secondary hover:text-fg-primary text-sm font-medium transition-colors"
          >
            {item.name}
          </a>
        ))}
      </div>

      <!-- Desktop CTA -->
      <div class="hidden md:flex items-center gap-4">
        <a
          href="https://github.com/meysam81/oneoff"
          target="_blank"
          rel="noopener noreferrer"
          class="text-fg-muted hover:text-fg-primary transition-colors"
          title="GitHub"
        >
          <Icon name="github" size={20} />
        </a>
        <Button href="/#installation" size="sm">
          Download
        </Button>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="md:hidden flex items-center justify-center w-10 h-10 -mr-2 text-fg-muted hover:text-fg-primary hover:bg-bg-tertiary/50 rounded-lg transition-all active:scale-95"
        aria-label="Toggle menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <Icon name="menu" size={22} id="menu-icon" class="transition-transform duration-200" />
        <Icon name="x" size={22} id="close-icon" class="hidden transition-transform duration-200" />
      </button>
    </nav>
  </Container>

  <!-- Mobile Navigation -->
  <div
    id="mobile-menu"
    class="md:hidden absolute top-full left-0 right-0 bg-bg-secondary/95 backdrop-blur-lg border-b border-border-subtle transform transition-all duration-300 ease-out opacity-0 -translate-y-2 pointer-events-none"
    aria-hidden="true"
  >
    <Container size="xl">
      <div class="py-3 space-y-1">
        {navigation.map((item, index) => (
          <a
            href={item.href}
            class="mobile-menu-item flex items-center justify-between px-4 py-3 text-fg-secondary hover:text-fg-primary active:text-accent-primary hover:bg-bg-tertiary/50 active:bg-bg-tertiary rounded-lg text-base font-medium transition-all"
            style={`transition-delay: ${index * 50}ms`}
          >
            <span>{item.name}</span>
            <Icon name="arrowRight" size={16} class="text-fg-muted" />
          </a>
        ))}
        <div class="pt-3 mt-3 border-t border-border-subtle space-y-3">
          <a
            href="https://github.com/meysam81/oneoff"
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-3 px-4 py-3 text-fg-secondary hover:text-fg-primary hover:bg-bg-tertiary/50 rounded-lg transition-all"
          >
            <Icon name="github" size={20} />
            <span class="text-base font-medium">View on GitHub</span>
          </a>
          <div class="px-4">
            <Button href="#installation" size="md" class="w-full justify-center">
              <Icon name="download" size={18} />
              Download
            </Button>
          </div>
        </div>
      </div>
    </Container>
  </div>
</header>

<script>
  // Header scroll effect
  const header = document.getElementById('site-header');
  const headerBg = document.getElementById('header-bg');

  function updateHeader() {
    if (window.scrollY > 50) {
      headerBg?.classList.add('border-border-subtle');
      headerBg?.classList.remove('border-transparent');
    } else {
      headerBg?.classList.remove('border-border-subtle');
      headerBg?.classList.add('border-transparent');
    }
  }

  window.addEventListener('scroll', updateHeader, { passive: true });
  updateHeader();

  // Mobile menu toggle
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');
  let isMenuOpen = false;

  function openMenu() {
    isMenuOpen = true;
    mobileMenu?.classList.remove('opacity-0', '-translate-y-2', 'pointer-events-none');
    mobileMenu?.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
    mobileMenu?.setAttribute('aria-hidden', 'false');
    menuBtn?.setAttribute('aria-expanded', 'true');
    menuIcon?.classList.add('hidden');
    closeIcon?.classList.remove('hidden');
    // Prevent body scroll when menu is open
    document.body.style.overflow = 'hidden';
  }

  function closeMenu() {
    isMenuOpen = false;
    mobileMenu?.classList.add('opacity-0', '-translate-y-2', 'pointer-events-none');
    mobileMenu?.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
    mobileMenu?.setAttribute('aria-hidden', 'true');
    menuBtn?.setAttribute('aria-expanded', 'false');
    menuIcon?.classList.remove('hidden');
    closeIcon?.classList.add('hidden');
    // Restore body scroll
    document.body.style.overflow = '';
  }

  menuBtn?.addEventListener('click', () => {
    if (isMenuOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  // Close mobile menu on link click
  mobileMenu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      closeMenu();
    });
  });

  // Close menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isMenuOpen) {
      closeMenu();
    }
  });

  // Close menu on resize to desktop
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 768 && isMenuOpen) {
      closeMenu();
    }
  }, { passive: true });
</script>
