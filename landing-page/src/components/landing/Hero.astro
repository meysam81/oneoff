---
import Container from '../ui/Container.astro';
import Button from '../ui/Button.astro';
import Badge from '../ui/Badge.astro';
import Icon from '../icons/index.astro';
import { getGitHubData } from '../../utils/github';
import {
  getAllDownloadCommands,
  getAllShortCommands,
  getAllRunCommands,
  getAllPromptChars,
  getAllDisplayNames,
} from '../../utils/os-detect';
import HeroTerminal from '../vue/HeroTerminal.vue';
import DownloadButton from '../vue/DownloadButton.vue';

const { majorVersion, fullVersion } = await getGitHubData();

const downloadCommands = getAllDownloadCommands(fullVersion);
const shortCommands = getAllShortCommands();
const runCommands = getAllRunCommands();
const promptChars = getAllPromptChars();
---

<section class="relative min-h-screen flex items-center pt-16 pb-12 sm:py-20 overflow-hidden">
  <!-- Background effects -->
  <div class="absolute inset-0 grid-bg opacity-50"></div>
  <div class="absolute inset-0 bg-gradient-to-b from-transparent via-bg-primary/50 to-bg-primary"></div>

  <!-- Floating terminal windows (decorative) - hidden on mobile/tablet -->
  <div class="absolute top-1/4 -left-20 w-72 h-48 bg-bg-secondary/20 rounded-lg border border-border-subtle transform -rotate-6 blur-sm opacity-30 hidden xl:block"></div>
  <div class="absolute bottom-1/4 -right-20 w-80 h-56 bg-bg-secondary/20 rounded-lg border border-border-subtle transform rotate-6 blur-sm opacity-30 hidden xl:block"></div>

  <Container size="xl" class="relative z-10">
    <div class="max-w-4xl lg:max-w-5xl xl:max-w-6xl mx-auto text-center px-1 sm:px-0">
      <!-- Badge -->
      <div class="mb-6 sm:mb-8 animate-fade-in">
        <Badge variant="accent">
          <span class="flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm">
            <span class="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-success rounded-full animate-pulse"></span>
            <span class="hidden xs:inline">{majorVersion} &bull; Open Source</span>
            <span class="xs:hidden">{majorVersion}</span>
          </span>
        </Badge>
      </div>

      <!-- Headline -->
      <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-display font-display font-bold text-fg-primary mb-4 sm:mb-6 animate-fade-in animate-delay-100 leading-tight">
        One-time jobs.<br />
        <span class="text-accent-primary text-glow">Zero dependencies.</span>
      </h1>

      <!-- Subheadline -->
      <p class="text-base sm:text-lg md:text-xl text-fg-secondary max-w-2xl mx-auto mb-8 sm:mb-10 animate-fade-in animate-delay-200 px-2 sm:px-0">
        The modern <code class="bg-bg-tertiary px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-accent-primary font-mono text-sm sm:text-base">at</code> command.
        Schedule HTTP webhooks, shell scripts, and Docker containers to run once at a specific time.
        <span class="hidden sm:inline">Single binary. Self-hosted. Done.</span>
      </p>

      <!-- CTA Buttons -->
      <div class="flex flex-col sm:flex-row items-center justify-center gap-3 sm:gap-4 mb-10 sm:mb-16 animate-fade-in animate-delay-300 px-4 sm:px-0">
        <Button href="#installation" size="lg" class="w-full sm:w-auto justify-center" id="download-btn">
          <Icon name="download" size={20} />
          <span class="sm:hidden">Download</span>
          <DownloadButton client:load />
        </Button>
        <Button href="https://github.com/meysam81/oneoff" variant="secondary" size="lg" external class="w-full sm:w-auto justify-center">
          <Icon name="github" size={20} />
          <span class="sm:hidden">GitHub</span>
          <span class="hidden sm:inline">View on GitHub</span>
          <img
            src="https://img.shields.io/github/stars/meysam81/oneoff?style=flat&color=22d3ee&labelColor=111113"
            alt="GitHub stars"
            class="h-5 ml-1 hidden md:block"
            loading="lazy"
          />
        </Button>
      </div>

      <!-- Terminal Animation -->
      <div class="animate-fade-in animate-delay-500 px-2 sm:px-0">
        <HeroTerminal
          client:load
          downloadCommands={downloadCommands}
          shortCommands={shortCommands}
          runCommands={runCommands}
          promptChars={promptChars}
        />
      </div>
    </div>
  </Container>

  <!-- Scroll indicator - hidden on small mobile -->
  <div class="absolute bottom-4 sm:bottom-8 left-1/2 -translate-x-1/2 animate-bounce hidden sm:block">
    <svg class="w-5 h-5 sm:w-6 sm:h-6 text-fg-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
    </svg>
  </div>
</section>
